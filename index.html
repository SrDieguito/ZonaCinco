<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Guardar Reporte</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2rem; }
    form > div { margin-bottom: 1rem; }
    label { display: block; font-weight: bold; margin-bottom: 0.3rem; }
    input { width: 100%; padding: 0.5rem; }
    button { padding: 0.6rem 1rem; background-color: #00983d; color: white; border: none; cursor: pointer; }
    .message { margin-top: 1rem; font-weight: bold; }
  </style>
</head>
<body>
  <h1>Guardar Reporte Diario</h1>

  <form id="reporte-form">
    <div>
      <label for="fecha">Fecha</label>
      <input type="date" id="fecha" name="fecha" required />
    </div>
    <div>
      <label for="ventas_efectivo">Ventas Efectivo</label>
      <input type="number" id="ventas_efectivo" name="ventas_efectivo" required step="0.01"/>
    </div>
    <div>
      <label for="ventas_transferencia">Ventas Transferencia</label>
      <input type="number" id="ventas_transferencia" name="ventas_transferencia" required step="0.01"/>
    </div>
    <div>
      <label for="egresos">Egresos</label>
      <input type="number" id="egresos" name="egresos" required step="0.01"/>
    </div>
    <div>
      <label for="utilidad">Utilidad</label>
      <input type="number" id="utilidad" name="utilidad" required step="0.01"/>
    </div>
    <div>
      <label for="caja_inicial">Caja Inicial</label>
      <input type="number" id="caja_inicial" name="caja_inicial" required step="0.01"/>
    </div>
    <div>
      <label for="total_depositar">Total a Depositar</label>
      <input type="number" id="total_depositar" name="total_depositar" required step="0.01"/>
    </div>
    <button type="submit">Guardar</button>
  </form>

  <div class="message" id="message"></div>

  <script>
    document.getElementById('reporte-form').addEventListener('submit', async function (e) {
      e.preventDefault();

      const form = e.target;
      const data = {
        fecha: form.fecha.value,
        ventas_efectivo: parseFloat(form.ventas_efectivo.value),
        ventas_transferencia: parseFloat(form.ventas_transferencia.value),
        egresos: parseFloat(form.egresos.value),
        utilidad: parseFloat(form.utilidad.value),
        caja_inicial: parseFloat(form.caja_inicial.value),
        total_depositar: parseFloat(form.total_depositar.value),
      };

      const messageDiv = document.getElementById('message');

      try {
        const response = await fetch('/api/save-report', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data),
        });

        const result = await response.json();

        if (response.ok) {
          messageDiv.textContent = `✅ Reporte guardado correctamente (ID: ${result.id})`;
          messageDiv.style.color = 'green';
          form.reset();
        } else {
          messageDiv.textContent = `❌ Error: ${result.message || 'Error desconocido'}`;
          messageDiv.style.color = 'red';
        }
      } catch (err) {
        messageDiv.textContent = `❌ Error de red: ${err.message}`;
        messageDiv.style.color = 'red';
      }
    });
  </script>
</body>
</html>
